{% load static %}
<html>
<body>
    <div class="container-logo">
            <img class="logos" src="{% static 'img/logos_report.png' %}" alt="logos">
    </div>
    <h2>EpiGe Medulloblastoma Subgroup Prediction Report</h2>
    <p>Sample ID: {{ sample.sample_identifier }}</p>
    <p>Uploaded file: {{ sample.filename}}</p>
    <p>Size file: {{ sample.filesize}}</p>
    <p>Instrument type: {{ calibration.instrument_type}}</p>
    <p>Email: {{ sample.email }}</p>
    <p>Date: {{ sample.created|date:"M d, Y, H:i:s" }}</p>

    <h3>EpiGe Medulloblastoma Subgroup Class Prediction (v1.1)</h3>
    <h3>Reference pattern data</h3>
    <div class="image-container">
        <img class="patterns" src="{% static 'img/tablaRef.png' %}" alt="patterns">
    </div>
    <h3>Results</h3>
    <p class="block-text">
    Sample pattern obtained by the logistic regression:
    </p>
    <div class="image-container">
        <img class="replicas" src="{{ classification.sample_image }}" alt="replicas">
    </div>
    <p class="block-text">
    Molecular subgroup obtained by the hamming distance:
    </p>
    <table>
        <thead>
        <tr>
            <th>Molecular subgroup</th>
            <th>Score WNT</th>
            <th>Score SHH</th>
            <th>Score non-WNT/non-SHH</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>{{ classification.subgroup }}</td>
            <td>{{ classification.score_wnt }}</td>
            <td>{{ classification.score_shh }}</td>
            <td>{{ classification.score_gg }}</td>
        </tr>
        </tbody>
    </table>
    <div class="image-container">
        <img class="radar" src="{{ classification.radar_plot }}" alt="replicas">
    </div>
    <h3>Subgroup Description</h3>
    <p><b>{{ classification.subgroup }}</b></p>
    {% if classification.subgroup == "WNT" %}
        <p class="block-text">Medulloblastoma (MB) genetically defined as Wingless-activated (WNT) is characterized by monosomy of chromosome 6 in more than 80% of tumors together with mutation of CTNNB1. Histologically most WNT cases are classified as classic or, less frequent, as large cell/anaplastic variant. WNT tumors are located in the cerebellum, typically in the vermis and the median age of presentation is 12 years. Patients with WNT MB have an excellent prognosis with current therapy schemes (5-year event free survival greater than 90%) and are currently considered for controlled reduction of treatment (<a href="https://clinicaltrials.gov" target="_blank" rel="noreferrer noopener">https://clinicaltrials.gov</a>).</p>
    {% elif classification.subgroup == "SHH" %}
        <p class="block-text">Medulloblastoma (MB) genetically defined as Sonic Hedgehog activated (SHH) are characterized by upstream SHH pathway alterations, such as PTCH1 and SMO, or SUFU. Young MB SHH patients may have germline origin associated to Gorlin’s syndrome. SHH MB subgroup class includes the majority of TP53-mutated MB tumors, often associated to Li-Fraumeni syndrome. This SHH-TP53 mutated tumors are typically associated with children about 8-15 years and often have large cell/anaplastic morphology, with large amount of copy number alterations even chromothripsis. Histologically most cases are classified as desmoplastic or extensive nodularity variant, less commonly as classic variant and occasionally as large cell/anaplastic. MB SHH tumors are located in the cerebellum with a tendency to be present laterally. Median age of presentation is 2 years for infants and 22 years for children and adult. The prognosis of SHH-activated MBs is largely dependent on patient’s age and specific genetic features where children with TP53 mutated SHH tumors have  poorer outcome. Subgroup-driven clinical trials are currently being conducted aimed at the estimation of the efficacy of SHH pathway inhibitors (e.g.vismodegib) at diagnosis or in recurrent or refractory SHH-activated tumors (<a href="https://clinicaltrials.gov" target="_blank" rel="noreferrer noopener">https://clinicaltrials.gov</a>).</p>
    {% elif classification.subgroup == "non-WNT/non-SHH" %}
        <p class="block-text">Medulloblastoma (MB) genetically defined as non-WNT/non-SHH is a provisionally entity composed by Group 3 and Group 4 MB subgroups (Louis DN, Perry A, Reifenberger G, von Deimling A, Figarella-BrangerD, Cavenee WK, et al. The 2016 World Health Organization Classification of Tumors of the Central Nervous System: a summary. Acta Neuropathol.2016;131:803-20. // Ramaswamy V, Remke M, Bouffet E, Bailey S, Clifford SC, DozF, et al. Risk stratification of childhood medulloblastoma in the molecular era: the current consensus. Acta Neuropathol. 2016;131:821-31). Group 3 and Group 4 have a low incidence of recurring mutations but are characterized by recurrent, partly overlapping, chromosomal alterations. Histologically most cases fall into the classical and large cell/anaplastic groups. Tumors are located in the cerebellum, typically in the vermis. non-WNT/non-SHH MB are more common in males than females. MYC amplification, MYCN amplification, aneuploidy, isochromosome 17q and GFI1/1B activation by enhancer hijacking are recurrent features, but a fraction lack an obvious driving genetic change. Patients with non-WNT/non-SHH tumors have the most unfavorable prognosis, especially when associated with MYC amplification.</p>
    {% else %}
        <p class="block-text"></p>
    {% endif %}
    <h3>Disclaimer</h3>
    <p class="block-text">Classification using methylation profiling is a research tool under development, it is not verified and has not been clinically validated. Implementation of the results in a clinical setting is in the sole responsibility of the treating physician.</p>
    <p>Intended for non-commercial use only.</p>
    <h3>Cytosine Methylation Status Predictor</h3>
    {{ classification.logistic_table | safe }}
    <p class="block-text">
        Probability threshold: 0.456
    </p>
    <h3>Quality Control Summary</h3>
    <table>
        <thead>
        <tr>
            <th>CheckPoint</th>
            <th>Result</th>
            <th>Possible Solution</th>
        </tr>
        </thead>
        <tbody>
            <tr>
                <td>TXT complete</td>
                <td colspan="2">The txt file contains all the information.</td>
            </tr>
            <tr>
                <td>All CpG</td>
                <td colspan="2">All 6 CpG are included.</td>
            </tr>
            <tr>
                <td>Dye calibration</td>
                {% if calibration.ROX_valid and calibration.VIC_valid and calibration.FAM_valid %}
                    <td colspan="2">All dyes are calibrated.</td>
                {% else %}
                    <td>Some of the dyes have expired calibration.</td>
                    <td>See the technical report for more information.</td>
                {% endif %}
            </tr>
            <tr>
                <td>No template controls</td>
                {% if not calibration.amplification_test %}
                    <td>Amplification has been detected in some no template controls.</td>
                    <td>See the technical report for more information.</td>
                {% else %}
                    <td colspan="2">No amplification was detected in any no template control.</td>
                {% endif %}
            </tr>
            <tr>
                <td>SD<0.5</td>
                {% if calibration.standard_deviation_test %}
                    <td>Some pairs of replicates have a standard deviation greater than 0.5.</td>
                    <td>See the technical report for more information.</td>
                {% else %}
                    <td colspan="2">No pairs of replicates have a standard deviation greater than 0.5.</td>
                {% endif %}
            </tr>
        </tbody>
    </table>
    <div class="pagebreak"> </div>
    <h2>Technical report</h2>
    <h3>Calibration information</h3>
    <table>
        <thead>
        <tr>
            <th>ROX is expired</th>
            <th>ROX performed</th>
            <th>FAM is expired</th>
            <th>FAM performed</th>
            <th>VIC is expired</th>
            <th>VIC performed</th>
        </tr>
        </thead>
        <tbody>
            <tr>
                <td>{% if calibration.ROX_valid %}No{% else %}Yes{% endif %}</td>
                <td>{{ calibration.ROX_date }}</td>
                <td>{% if calibration.FAM_valid %}No{% else %}Yes{% endif %}</td>
                <td>{{ calibration.FAM_date }}</td>
                <td>{% if calibration.VIC_valid %}No{% else %}Yes{% endif %}</td>
                <td>{{ calibration.VIC_date }}</td>
            </tr>
        </tbody>
    </table>
    <h3>No template control amplification</h3>
    {{ calibration.amplification_table | safe }}
    {% if calibration.amplification_test %}
        No amplification detected.
    {% else %}
        Amplification detected.
    {% endif %}
    <h3>SD<0.5</h3>
    {{ calibration.standard_deviation_table | safe }}
    {% if calibration.standard_deviation_test %}
        Some pairs of replicates have a standard deviation greater than 0.5.
    {% else %}
        No pairs of replicates have a standard deviation greater than 0.5.
    {% endif %}
    <h3>Run information</h3>
    <table>
        <thead>
        <tr>
            <th>Task</th>
            <th>Version</th>
        </tr>
        </thead>
        <tbody>
            <tr>
                <td>EpiGe_qc</td>
                <td>1.0</td>
            </tr>
            <tr>
                <td>EpiGe_logisticRegression</td>
                <td>1.0</td>
            </tr>
            <tr>
                <td>EpiGe_hammingDistance</td>
                <td>1.0</td>
            </tr>
            <tr>
                <td>EpiGe_report</td>
                <td>1.0</td>
            </tr>
        </tbody>
    </table>
</body>
</html>